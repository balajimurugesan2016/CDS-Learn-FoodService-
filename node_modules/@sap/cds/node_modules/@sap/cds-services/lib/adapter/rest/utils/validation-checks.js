const { processDeep } = require('../../../util/dataProcessUtils')
const { checkKeys, checkStatic } = require('../../../util/assert')
const combineErrors = require('../../../errors/combineErrors')
module.exports = (event, data, target) => {
  const checkResult = []

  let validateFn

  if (event === 'UPDATE' && Array.isArray(data)) {
    validateFn = (entry, entity) => {
      checkResult.push(...checkKeys(entity, entry))
      checkResult.push(...checkStatic(entity, entry, true))
    }
  } else {
    validateFn = (entry, entity) => {
      checkResult.push(...checkStatic(entity, entry, true))
    }
  }

  processDeep(validateFn, data, target, false, true)

  const error = combineErrors(checkResult)
  if (error) error.statusCode = 400

  return error
}
